---
title: 虎书笔记——Miscellaneous Math
tags:
  - 图形学
categories:
  - 图形学
date: 2022-04-21 10:01:45
---

# 2 各种各样的数学

很多图形算法只是将数学直接翻译成了代码。数学运算越整洁，生成的最终代码也越整洁。这本书的很多内容都集中于使用正确的数学方法上。本章回顾了高中和大学数学中的各种工具，主要是作为参考而不是教程。它可能看起来像是大杂烩（实际上它确实是的），每个被选择的主题或许是在“标准”数学课程中有点不寻常，或许是图形学中至关重要的内容，又或许是它通常不是从几何角度来处理的。除了建立对符号的回顾之外，本章还强调了有时会被本科课程跳过的几个知识点，例如三角形的重心坐标。本章不打算对相关资料做严格处理，相反的，我们反而会强调直觉和几何解释。有关线性代数的部分将会被延迟到第五章进行，然后再进行变换矩阵的相关讨论。我们鼓励读者快速浏览本章来了解本章涉及的相关话题，并根据需要再去参考具体的内容。在本章最后的练习有助于帮助你了解哪些话题需要复习。

## 2.1 集合和映射

映射（也叫做函数）是数学和编程的基础概念。就像程序中的一个函数一样，数学中的映射将一种类型的参数映射（返回）到一个特定类型的对象。在编程中我们常用"类型"（type）这个词，而在数学中，我们会将其定义为集合（set）。当我们有一个对象，并且它是集合中的一个成员时，我们使用$\in$这个符号，例如：
$$a \in \mathbf{S},$$
它被读作“$a$属于集合$\mathbf{S}$”。对于给定的任意两个集合$\mathbf{A}$和$\mathbf{B}$，我们通过笛卡儿积来创建第三个集合，记作$\mathbf{A} \times \mathbf{B}$。集合$\mathbf{A} \times \mathbf{B}$包含了所有可能的有序对$(a,b)$，其中$a \in \mathbf{A},b \in \mathbf{B}$。为了简化，我们使用$\mathbf{A^2}$来指代$\mathbf{A} \times \mathbf{A}$。我们可以扩展笛卡尔积，使用三个集合来创建一个包含所有可能的有序三元组的集合，或者是来自任意n个集合的有序n元组。
常用的集合包括：

- $\mathbb{R}$：所有实数
- $\mathbb{R^+}$：所有非负实数（包括0）
- $\mathbb{R^2}$：2D实数平面上的有序数对
- $\mathbb{R^n}$：n维笛卡尔空间中的点
- $\mathbb{Z}$：所有整数
- $\mathbb{S^2}$：单位球体上3D点（$\mathbb{R^3}$中的点）的集合

我们注意到虽然$\mathbf{S^2}$是由三维空间中的点组成的，但是它们位于一个由两个参数化变量决定的曲面上，因此它也可以被视为一个二维集合。使用一个箭头和冒号来作为映射的标记，例如：
$$f : \mathbb{R} \mapsto \mathbb{Z} $$
你可以读作：有一个函数$f$将一个实数作为输入并映射成一个整数。在这个表达式中，箭头左边的集合叫做函数的定义域（domain），箭头右边的集合叫做目标域（target）。计算机程序员可能更熟悉一下的表述：这是一个叫做f的函数，它有一个实数参数并返回一个整数。换言之，上面的集合表示法和常用的编程表示法是等价的：
$$integer \nobreakspace f(real) \leftarrow equivalent \rightarrow f : \mathbb{R} \mapsto \mathbb{Z}$$
即冒号-箭头表示法可以被认为是一种编程语法，就是这么简单。
点$f(a)$被称为$a$的像，集合$A$（定义域的子集）的像是目标域的子集，即包含所有集合$A$中所有点的像。整个定义域的像被称为函数的值域。

### 2.1.1 逆映射

如果我们有一个函数$f : \mathbf{A} \mapsto \mathbf{B}$，那么也会存在一个逆函数（反函数）$f^{-1} : \mathbf{B} \mapsto \mathbf{A}$，这是通过规则$f^{-1}(b) = a$定义的，其中$b=f(a)$。当每个$b \in B$是f下某个点的像（即目标域和值域等价），并且只有一个这样的点（即只有一个a使得$f(a)=b$）。这样的映射被成为双射。对于一个双射，它将每个$a \in \mathbf{A}$映射到唯一的$b \in \mathbf{B}$；且对于每一个$b \in \mathbf{B}$，有且仅有一个$a \in \mathbf{A}$使得$f(a)=b$成立。一群骑士和马之间的双射表面，每一个骑士都骑着一匹马，每一匹马都被一个骑士骑着。对于$rider(horse)$和$horse(rider)$这两个函数，它们互为逆函数。不是双射的函数没有逆函数。
对于$f : \mathbb{R} \mapsto \mathbb{R} $中的一个双射，如$f(x) = x^3$，它的逆函数是$f^{-1}(x) = \sqrt[3]{x}$。这个例子告诉我们，有时候标准符号会产生一些歧义，因为$x$作为一个虚拟变量被同时使用在了$f$和$f^{-1}$中。所以有时候使用不同的虚拟变量会显得更加直观一点，即$y = f(x)$和$x = f^{-1}(y)$，这样会使得$y = x^3$和$x = \sqrt[3]{y}$更加直观。对于$sqr: \mathbb{R} \mapsto \mathbb{R}$中的一个函数$sqr(x) = x^2$，它就没有逆函数。第一个原因是$x^2 = (-x)^2$，第二个原因是定义域的成员会被映射到目标域的负部分。这里需要注意，如果我们将定义域和值域限制在$\mathbb{R}^+$，那么刚才的函数就有逆函数了，即$\sqrt{x}$。

### 2.1.2 区间

通常我们希望指定一个函数所处理的实数是受到数值限制的，一种限制方式就是指定一个区间。区间的一个例子是0到1之间的实数（不包括0和1），我们将其表示为$(0,1)$。这样的区间被称为开区间，因为它不包括范围的端点。与之相反的是闭区间，该区间包含范围的端点，我们使用方括号来表示它，即$[0,1]$。开闭区间的符号是可以混合使用的，如区间$[0,1)$表示包含0但不包含1。当我们写下一个区间$[a,b]$的时候，我们默认假设$a \leq b$。一般有三种方式来表示这样的区间，数轴区间法、不等式表示法和区间表示法。区间的笛卡尔积也是经常使用的，例如：可以使用$x \in [0,1]^3$来表示3D单位立方体内的点。
区间在和交集、并集、差集等集合操作一起使用的时候是很方便的。举个例子，两个集合之间的交集部分是它们所共有的点，使用符号$\cap$来表示交集运算。例如：$[3,5) \cap [4,6] = [4,5)$。对于并集运算，使用符号$\cup$来表示任意一个区间中的点，例如：$[3,5) \cup [4,6] = [3,6]$。和前面两种运算不同的是，差集运算根据参数的顺序不同，会产生不同的运算结果。使用减法符号来表示差集运算，它返回左边集合有，但是右边集合没有的点。例如：$[3,5) - [4,6] = [3,4)$，$[4,6] - [3,5) = [5,6]$。可以使用去见图很容易的展示这些运算。

### 2.1.3 对数

虽然不像在计算机出现之前那么普遍，但是对数在带有指数项的方程问题中很有用。根据定义，每一个指数都有一个底数$a$，$log$以$a$为底，$x$的对数写作$\log_a x$，它被定义成“为了得到$x$，必须增大$a$的指数”，即：
$$y = log_a x \iff a^y = x$$
注意，以$a$为底的对数函数和$a$的幂函数互为逆函数，这个基本定义有以下推论：

$$
a^{log_a (x)} = x;\\[2mm]
log_a {(a^x)} = x;\\[2mm]
log_a(xy) = log_a x + log_a y;\\[2mm]
log_a (x/y) = log_a x - log_a y;\\[2mm]
log_a x = log_a b log_b x.
$$

当我们对对数运算应用微积分的时候，特殊数字$e = 2.718...$会经常出现。以$e$为底的对数被成为自然对数，我们常用$\ln$来表示它：
$$\ln x \equiv log_e x$$
注意，符号“$\equiv$”读作“在定义上是等价的”。类似于$\pi$，特殊数字$e$在很多场景都会出现。在许多情况下，除了使用特殊底数$e$之外，还会使用其他特殊的底数来进行操作，并且在符号中省略了底数如$\log x$。举个例子，天文学家经常使用10作为底数，理论计算机学家通常使用2作为底数。由于计算机图形学借鉴了很多领域中的技术，因此我们会避免这种简略的表达方式。
对数和指数的导数说明了为什么自然对数是“自然”的：
$$
\frac{d}{dx}log_a x = \frac{1}{x \ln a}; \\[3mm]
\frac{d}{dx}a^x = a^x \ln a.
$$
只有当$a = e$的时候，上面的常数乘法才是一致的。

## 2.2 求解二次方程

一个一元二次方程有以下形式：
$$Ax^2 + Bx + C = 0$$
方程中的x是一个未知实数，$A，B，C$是已知常数。如果你想到一个二维xy坐标系和$y = Ax^2 + Bx + C$，那么原方程的解就是函数图像与x轴相交点的$x$值。由于$y = Ax^2 + Bx + C$是一条抛物线，因此根据抛物线和x轴的相交情况（未经过，掠过，穿过），原方程有0个，1个或者2个解三种情况。
为了求出该二次方程的解析解，我们首先在等式两边都除以$A$：
$$x^2 + \frac{B}{A}x + \frac{C}{A} = 0$$
然后将其变形为完全平方的形式：
$$(x + \frac{B}{2A})^2 - \frac{B^2}{4A^2} + \frac{C}{A} = 0$$
将常数项移动到等式右边，并进行开方运算：
$$x + \frac{B}{2A} = \pm \sqrt{\frac{B^2}{4A^2} - \frac{C}{A}}$$
等式两边同时减去$B/(2A)$，然后进行通分、合并同类项：
$$x = \frac{-B \pm \sqrt{B^2 - 4AC}}{2A} \tag{2.1}$$
这里的符号“$\pm$”代表方程有两个解，一个是正号，另一个是负号，如$3 \pm 1$的结果是2或4。观察等式，我们可以发现决定方程实数解个数的项是：
$$D \equiv B^2 - 4AC$$
这叫做二次方程的判别式。如果$D > 0$，则方程有两个实数解（也叫做根）；如果$D = 0$，则方程只有一个实数解（两个相等的根）；如果$D < 0$，则方程没有实数解。
举个例子，$x=-1，x=-2$是方程$2x^2 + 6x + 4 = 0$的两个根，而方程$x^2 + x + 1 = 0$则没有实数解。它们的判别式分别是$D=4$和$D=-3$，这符合我们对解数量的预期。在程序中，可以先检查判别式D的值，如果D是负数的话，可以直接返回无解。

## 2.3 三角学

在图形学的很多地方都会用到三角学，通常来说都不是什么太花哨的东西，而且它对于理解基本定义有所帮助。

### 2.3.1 角度

尽管我们将角度看成理所当然的东西，但是我们仍然需要去回顾它的定义，这样我们才能将角度的概念扩展到球体上。
角度形成于两条半直线（从原点发出的无限射线）或者方向之间，由于这样产生的角度有两种可能性，因此我们必须使用一些约定来决定哪一个是生成的角度。角度由它在单位圆上切割的弧度长度所定义，通常我们使用较短的那个圆弧来决定生成的角度，同时角度的符号由两个半直线的顺序决定。根据这样的规定，所有的角度大小都在范围$[-\pi,\pi]$内。
这些角度的大小等于*单位圆上被两个方向所切割的弧的长度*。由于单位圆的周长是$2\pi$，因此两个角度之和也是$2\pi$，这些弧长的单位是*弧度*。另一个常用的单位是角度，一个圆周是360度。即一个弧度为$\pi$的角是180度，通常记作$180\degree$。角度和弧度的转换规则如下：
$$
degrees = \frac{180}{\pi}radians \\[3mm]
radians = \frac{\pi}{180}degrees
$$

### 2.3.2 三角函数

给定直角三角形的三条边长$a,o,h$，其中h是最长边（又叫做弦，是直角的对边）的长度。根据勾股定理，有以下重要关系：
$$a^2 + o^2 = h^2$$

![图2.7](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202204241847644.png  "图2.7")

如上图，大正方形面积为$(a+o)^2$，四个三角形面积合计为$2ao$，中间的正方形面积为$h^2$。由于三角形和中间的正方形将大正方形均匀分割，因此由$2ao + h^2 = (a + o)^2$，很容易能够推导出上面的定理。
我们定义了角度$\phi$的正弦和余弦，以及其他的基于比例的三角表达式：
$$
\sin \phi \equiv o/h; \\[1mm]
\csc \phi \equiv h/o; \\[1mm]
\cos \phi \equiv a/h; \\[1mm]
\sec \phi \equiv h/a; \\[1mm]
\tan \phi \equiv o/a; \\[1mm]
\cot \phi \equiv a/o. \\[1mm]
$$
这些定义允许我们建立极坐标系，在极坐标系中，一个点被编码为一个距原点的距离和一个相对于X轴正方向的有向角度。需要注意的是，我们约定了角度范围为$\phi \in (-\pi, \pi]$，并且X轴正方向的逆时针方向为角度的正方向。这个将逆时针方向作为正方向的约定是任意的，但是在图形学中被用在了很多地方，因此最好是记住这个约定。
三角函数具有周期性，并且能够将任意角度作为参数，例如：$\sin(A) = \sin(A=2\pi)$。这意味着在实数范围内进行考虑的话，这些函数都是不可逆的。这个问题可以通过限制标准逆函数的值域来完成，几乎所有的现代数学库都以一种标准的方式来实现。它们的定义域和值域如下：
$$
asin:[-1,1] \mapsto [-\pi/2, \pi/2];\\[1mm]
acos:[-1,1] \mapsto [0, \pi/2];\\[1mm]
atan:\mathbb{R} \mapsto [-\pi/2, \pi/2];\\[1mm]
atan2:\mathbb{R^2} \mapsto[-\pi, \pi].\tag{2.2}
$$
其中最后一个函数atan2$(s,c)$非常有用，它使用变量$s$和变量$c$以相同的系数来对$\sin A$和$\cos A$进行缩放，并最终以弧度的形式返回A，当然这个系数假设是一个正数。一种理解方式是，它在极坐标系下返回了一个二维笛卡尔坐标$(s, c)$的角度。

### 2.3.3 有用的等式

本小节中列举了一些非常有用的三角恒等式，但是不加证明。
**位移恒等式：**
$$
\sin(-A) = -\sin A \\[1mm]
\cos(-A) = \cos A \\[1mm]
\tan(-A) = -\tan A \\[1mm]
\sin(\pi/2 - A) = \cos A \\[1mm]
\cos(\pi/2 - A) = \sin A \\[1mm]
\tan(\pi/2 - A) = \cot A \\[1mm]
$$
> 高中口诀1：一全正，二正弦，三正切，四余弦。
> 高中口径2：奇变偶不变，符号看象限。yyds

**勾股恒等式：**
$$
\sin^2 A + \cos^2 A = 1 \\[1mm]
\sec^2 A + \tan^2 A = 1 \\[1mm]
\csc^2 A - \cot^2 A = 1 \\[1mm]
$$

**加减恒等式：**
$$
\sin(A + B) = \sin A \cos B + \sin B \cos A \\[1mm]
\sin(A - B) = \sin A \cos B - \sin B \cos A \\[1mm]
\sin(2A) = 2\sin A \cos A \\[1mm]
\cos(A + B) = \cos A \cos B - \sin A \sin B \\[1mm]
\cos(A - B) = \cos A \cos B + \sin A \sin B \\[1mm]
\cos(2A) = \cos^A - \sin^A \\[1mm]
\tan(A + B) = \frac{\tan A + \tan B}{1 - \tan A \tan B} \\[2mm]
\tan(A - B) = \frac{\tan A - \tan B}{1 + \tan A \tan B} \\[2mm]
\tan(2A) = \frac{2\tan A}{1 - \tan^A} \\[1mm]
$$

**半角恒等式：**
$$
\sin^2(A/2) = (1 - \cos A) / 2 \\[1mm]
\cos^2(A/2) = (1 + \cos A) / 2
$$

**积化和差恒等式：**
$$
\sin A \sin B = -(\cos(A + B) - \cos(A - B)) / 2 \\[1mm]
\sin A \cos B = (\sin(A + B) - \sin(A - B)) / 2\\[1mm]
\cos A \cos B = (\cos(A + B) + \cos(A - B)) / 2
$$

对于边长为$a,b,c$及其各自对角为$A,B,C$的任意三角形，有以下等式：
$$
\frac{\sin A}{a} = \frac{\sin B}{b} = \frac{\sin C}{c} (正弦定理)\\[2mm]
c^2 = a^2 + b^2 - 2ab\cos C(余弦定理)\\[2mm]
\frac{a + b}{a - b} = \frac{\tan(\frac{A + B}{2})}{\tan(\frac{A - B}{2})}(正切定理)
$$

三角形的面积可以通过三边边长计算获得：
$$
三角形面积 = \frac{1}{4} \sqrt{(a + b + c)(-a + b + c)(a - b + c)(a + b - c)}
$$

## 2.4 向量

一个向量描述了一个方向和一个长度，它可以很方便的使用箭头来表示。我们认为拥有相同长度和方向的两个向量是相等的，即使它们的位置不一样。你应该尽可能地将向量看作一个箭头而不是坐标或者数字，虽然有些时候我们不得不在程序中将向量表示成数字形式，但是它们在代码中需要被作为一个对象整体来进行操作和运算，只有低级的向量操作才需要知道它们的数字表示（DeRose，1989）。向量会被表示成加粗的符号如$\mathbf{a}$，向量的长度记作$\Vert \mathbf{a} \Vert$。长度为1的向量被称为单位向量；零向量的长度为0，方向没有定义。
向量可以用来表示很多不同的东西，例如偏移，也叫做位移。如果你听说了“宝藏被埋藏在了秘密会议地点以东两步，以北三步的地方”，这样虽然你知道了偏移程度，但是你并不知道从哪里开始。向量也可以被用来表示定位，即位置或者点。位置可以被描述成从另一个位置开始的一段位移，通常会有一些已知的起点，然后其他的位置会被存储为相对起点的偏移量。请注意，位置并不是向量，就像我们即将讨论的那样，你可以将两个向量相加，但是将两个位置相加通常并没有什么实际意义，除非是在计算位置加权平均时的中间操作（Goldman，1985）。将两个偏移量相加是有意义的，这也是为什么偏移量是向量的原因之一。这也进一步强调了位移也不是偏移量，偏移量是相对于一个特定起点而言的，但是便宜本身并不是位置。

### 2.4.1 向量运算

对于常见的实数运算操作，向量大部分也有。两个向量相等当且仅当它们拥有相同的长度和方向。两个向量的加法遵循平行四边形法则。该法则规定两个向量的和可以通过将一个向量的尾部（起点）移动到另一个向量的头部（终点）获得。和向量就是和之前两个向量一起“构建整个三角形”的的向量。这样的平行四边形可以通过任意的向量顺序构建，这强调了向量加法遵循交换律。
$$
\mathbf{a} + \mathbf{b} = \mathbf{b} + \mathbf{a}
$$
请注意，平行四边形法则其实只是具象化了我们对于位移的直觉，想象沿着一个向量前进，从起点到终点，然后再沿着另一个向量前进，最后的和位移就是平行四边形的对角线。你可以给向量添加一个符号：$-\mathbf{a}$代表了这个向量和$\mathbf{a}$具有相同的长度，但是相反的方向，这允许我们来定义向量减法：
$$
\mathbf{b} - \mathbf{b} = - \mathbf{a} + \mathbf{b}
$$
你也可以通过一个平行四边形来形象的描述向量减法，即：
$$
\mathbf{a} + ( \mathbf{b} - \mathbf{a}) = \mathbf{b}
$$
向量也有乘法，但是向量之间有几种不同的乘法。首先，我们可以通过将向量和一个实数$k$相乘来对其进行缩放，这其实只改变了向量的长度，其方向没有改变，例如：向量$3.5 \mathbf{a}$是一个和向量$\mathbf{a}$具有相同方向，但是长度是其3.5倍的向量。两个向量之间的乘法有两种——点乘和叉乘，本节的晚些时候会对其进行讨论。还有三个向量直接的乘法——行列式，将在第五章中进行讨论。

### 2.4.2 向量的笛卡尔坐标

一个二维向量能够被表示成任意两个非零向量的组合。这两个向量之间的性质被叫做*线性无关*。两个线性无关的向量构成了一个二维基底，这两个向量也被叫做基向量。例如：向量$\mathbf{c}$能够被表示成基向量$\mathbf{a}$和$\mathbf{b}$的组合：
$$
\mathbf{c} = a_c \mathbf{a} + b_c \mathbf{b} \tag{2.3}
$$
请注意，上述公式中的$a_c$和$b_c$都是唯一的。当两个基向量正交，即相互垂直的时候非常有用；当它们不仅正交，且长度都为1的时候更有用，这种情况叫做标准正交。如果我们假设已知两个标准正交向量$\mathbf{x}$和$\mathbf{y}$，那么我们就可以使用它们在笛卡尔坐标系下表示其他任何向量，每个向量都可以用两个实数表示，例如：向量$\mathbf{a}$可以被表示成：
$$
\mathbf{a} = x_a \mathbf{x} + y_a \mathbf{y}
$$
其中的$x_a$和$y_a$是二维向量$\mathbf{a}$的实数笛卡尔坐标。请注意，这在概念上和公式$(2.3)$没有什么区别，只是其中的基向量不是正交的。使用笛卡尔坐标系有一些优点，举个例子：在笛卡尔坐标系中，向量\mathbf{a}的长度是：
$$
\Vert a \Vert = \sqrt{x^{2}_a + y^{2}_a}
$$
在笛卡尔坐标系中计算点乘、叉乘和坐标也很简单，我们将在接下来的章节中看到
按照约定，我们将向量$\mathbf{a}$的坐标写成有序数对$(x_a, y_a)$或者列矩阵：
$$
\mathbf{a} =
\begin{bmatrix}
x_a \\
y_a
\end{bmatrix}
$$
我们使用这种形式是为了方便排版。有时我们也会将向量写成一个行向量，使用$\mathbf{a}^\mathrm{T}$来标记它：
$$
\mathbf{a} =
\begin{bmatrix}
x_a & y_a
\end{bmatrix}
$$
我们也可以使用笛卡尔坐标来表示三维、四维等向量。对于三维向量而言，我们使用了一个与$\mathbf{x}$和$\mathbf{y}$同时正交的向量$\mathbf{z}$。

### 2.4.3 向量的点乘

两个向量间最简单的乘法就是点乘，向量$\mathbf{a}$和向量$\mathbf{b}$的点乘记作$\mathbf{a} \cdot \mathbf{b}$，点乘的结果通常也叫做数量积，因为它返回一个标量。点乘返回一个和向量长度及其夹角$\phi$有关的数值：
$$
\mathbf{a} \cdot \mathbf{b} = \Vert \mathbf{a} \Vert \Vert \mathbf{b} \Vert \cos{\phi} \tag{2.4}
$$
在图形程序中，点乘最常用的便是用来计算两个向量夹角的余弦值。
点乘也可以用来计算一个向量在另一个向量上的投影，向量$\mathbf{a} \rightarrow \mathbf{b}$的长度代表了$\mathbf{a}$在$\mathbf{b}$上的直角投影:
$$
\mathbf{a} \rightarrow \mathbf{b} = \Vert \mathbf{a} \Vert \cos{\phi} = \frac{\mathbf{a} \cdot \mathbf{b}}{\Vert \mathbf{b} \Vert} \tag{2.5}
$$
点乘运算和实数运算一样，都遵循结合律和分配律：
$$
\mathbf{a} \cdot \mathbf{b} = \mathbf{b} \cdot \mathbf{a} \\
\mathbf{a} \cdot (\mathbf{b} + \mathbf{c}) = \mathbf{a} \cdot \mathbf{b} + \mathbf{a} \cdot \mathbf{c} \\
(k\mathbf{a}) \cdot \mathbf{b} = \mathbf{a} \cdot (k\mathbf{b}) = k\mathbf{a} \cdot \mathbf{b}\tag{2.6}
$$
如果二维向量$\mathbf{a}$和$\mathbf{b}$用笛卡尔坐标系表示，那么我们可以使用$\mathbf{x} \cdot \mathbf{x} = \mathbf{y} \cdot \mathbf{y} = 1, \mathbf{x} \cdot \mathbf{y}=0$来推导其点乘结果：
$$\begin{aligned}
\mathbf{a \cdot b} &= (x_a \mathbf{x} + y_a \mathbf{y}) \cdot  (x_b \mathbf{x} + y_b \mathbf{y}) \\
&=x_a x_b(\mathbf{x \cdot x}) + x_a y_b(\mathbf{x \cdot y}) + x_b y_a(\mathbf{y \cdot x}) + y_a y_b(\mathbf{y \cdot y}) \\
&= x_a x_b + y_a y_b
\end{aligned}$$
类似的，在三维空间中：
$$
\mathbf{a \cdot b} = x_a x_b + y_a y_b + z_a z_b
$$

### 2.4.4 向量的叉乘

向量的叉乘如$\mathbf{a \times b}$一般用于三维向量，广义的叉乘在章节注释的引用中被讨论。叉乘的结果是一个向量，该向量垂直于参与叉乘的两个向量，其长度和$\sin \phi$有关：
$$
\Vert \mathbf{a \times b} \Vert = \Vert \mathbf{a} \Vert \Vert \mathbf{b} \Vert \sin \phi
$$
$\Vert \mathbf{a \times b} \Vert$的大小和由向量$\mathbf{a},\mathbf{b}$所构成的平行四边形的面积相等。向量$\mathbf{a \times b}$同时垂直于向量$\mathbf{a, b}$。请注意，对于这样一个向量，它有两个可能的方向。根据定义，$x, y, z$轴的方向如下：
$$
\mathbf{x} = (1,0,0) \\
\mathbf{y} = (0,1,0) \\
\mathbf{z} = (0,0,1)
$$
我们可以进行规定，$\mathbf{x \times y}$必须与$\mathbf{z}$同向或者反向。这个选择有些随意，标准的做法是：
$$
\mathbf{z = x \times y}
$$
三维笛卡尔单位向量的所有可能组合如下：
$$
\mathbf
{
x \times y = + z, \\
y \times x = - z, \\
y \times z = + x, \\
z \times y = - x, \\
z \times x = + y, \\
x \times z = - y.
}
$$
根据$\sin \phi$的性质，我们可以得知一个向量和自己叉乘的结果是0，即$\mathbf{x \times x = 0}$。请注意，向量的叉乘是不满足交换律的，即$\mathbf{x \times y \neq y \times x}$。细心的观察者可能会发现，上面的讨论不能使我们很清楚的画出笛卡尔坐标轴之间的关系。更具体地说，如果我们将$\mathbf{x, y}$放在人行道上，其中$\mathbf{x}$朝东，$\mathbf{y}$朝西，那么$\mathbf{z}$将会指向天空还是地底呢？通常规定$\mathbf{z}$指向天空，这被称为*右手系*。这个名字来自于将你的右手手掌和手指“抓住”$\mathbf{x}$，然后将它旋转到$\mathbf{y}$的形象记忆。这时向量$\mathbf{z}$和你的大拇指指向同一个方向。
向量叉乘有一个很棒的属性：
$$
\mathbf{a \times (b + c)} = \mathbf{a \times b + a \times c}
$$
并且：
$$
\mathbf{a} \times (k \mathbf{b}) = k(\mathbf{a \times b})
$$
同时，根据右手定则，有：
$$
\mathbf{a \times b} = -\mathbf{b \times a}
$$
在笛卡尔坐标系中，我们可以使用显式展开来计算向量的叉乘：
$$\begin{aligned}
\mathbf{a \times b} &= (x_a \mathbf{x} + y_a \mathbf{y} + z_a \mathbf{z}) \times (x_b \mathbf{x} + y_b \mathbf{y} + z_b \mathbf{z}) \\
&=x_ax_b\mathbf{x \times x} + x_ay_b\mathbf{x \times y} + x_az_b\mathbf{x \times z} \\
&y_ax_b\mathbf{y \times x} + y_ay_b\mathbf{y \times y} + y_az_b\mathbf{y \times z} \\
&z_ax_b\mathbf{z \times x} + z_ay_b\mathbf{z \times y} + z_az_b\mathbf{z \times z} \\
&=(y_az_b - z_ay_b)\mathbf{x} + (z_ax_b - x_az_b)\mathbf{y} + (x_ay_b - y_ax_b)\mathbf{z} \tag{2.7}
\end{aligned}$$
写成坐标形式即：
$$
\mathbf{a \times b} = (y_az_b - z_ay_b, z_ax_b - x_az_b, x_ay_b - y_ax_b) \tag{2.8}
$$

### 2.4.5 标准正交基和坐标系

图形程序的核心任务之一是管理坐标系，这个任务的关键就是管理正交基底。对于任意集集合中的两个向量$\mathbf{u,v}$，只要它们相互正交（垂直）并且它们的长度都是单位长度，那么它们就能构成一个标准正交基，即：
$$
\Vert \mathbf{u} \Vert = \Vert \mathbf{v} \Vert = 1,\\[1mm]
\mathbf{u \cdot v} = 0.
$$
在三维空间中，一组在正交基底$\mathbf{u,v,w}$满足以下条件：
$$
\Vert \mathbf{u} \Vert = \Vert \mathbf{v} \Vert = \Vert \mathbf{v} \Vert= 1,\\[1mm]
\mathbf{u \cdot v} = \mathbf{v \cdot w} = \mathbf{w \cdot u} = 0.
$$
符合右手定则的一组正交基底满足:
$$
\mathbf{w = u \times v}
$$
不满足该情况的即为左手系。
请注意，笛卡尔标准正交基底只是无穷多个可能的基底中的其中一个，它的特殊之处在于，它和它的隐式原点被用于了程序中的低级表现形式，即向量$\mathbf{x,y,z}$和原点$\mathbf{o}$从来没有被显式存储。全局模型一般被存储在这个标准坐标系中，因此它通常被叫做*全局坐标系*。但是，如果我们想使用一个其他的坐标系，如原点在$\mathbf{p}$，标准正交基底分别为$\mathbf{u,v,w}$，对于这样的坐标系，我们会将向量显式存储起来。这样的坐标系会被叫做*参考坐标系*，例如：在一个飞行模拟器中，我们希望维护一个坐标系，该坐标系原点位于机头，标准正交基底和飞机对齐。同时，我们也会有一个主坐标系（如图2.21）。具体的物体有关的坐标系，例如飞机，它通常被叫做*局部坐标系*。

![图2.21 飞行器坐标系](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202204281451483.png)

>图2.21：场景中一直会有一个主坐标系，或者叫“标准坐标系”存在，它的原点为$\mathbf{o}$，正交基底为$\mathbf{x,y,z}$。这个坐标系一般被定义为和全局模型保持对齐，因此通常被叫做“全局”或者“世界”坐标系。该坐标系的原点和基向量不会被显式存储。其他所有的向量和位置都相对于它进行存储。这里和地面相关的坐标系被以全局坐标的形式显式存储。

在较低级别上，局部坐标可以被存储成标准坐标。例如：如果$\mathbf{u}$的标准坐标为$(x_u,y_u,z_u)$，则有：
$$
\mathbf{u} = x_u\mathbf{x} + y_u\mathbf{y} + z_u\mathbf{z}
$$
一个位置可以被隐式的存储为相对标准原点的偏移量：
$$
\mathbf{p} = \mathbf{o} + x_p\mathbf{x} + y_p\mathbf{y} + z_p\mathbf{z}
$$
其中的$(x_p, y_p, z_p)$即为$\mathbf{p}$的坐标。
请注意，如果我们以$\mathbf{u-v-w}$坐标系为参考存储向量$\mathbf{a}$，我们可以存储一个三元组$(u_a, v_a, w_a)$，它的几何解释是：
$$
\mathbf{a} = u_a\mathbf{u} + v_a\mathbf{v} + w_a\mathbf{w}
$$
为了得到存储在$\mathbf{u-v-w}$坐标系中的向量$\mathbf{a}$的标准坐标，这时我们需要简单回想起，$\mathbf{u-v-w}$是以笛卡尔坐标的形式存储的，因此表达式$u_a\mathbf{u} + v_a\mathbf{v} + w_a\mathbf{w}$也是以笛卡尔坐标显式存储的。为了获取存储在标准坐标系中的向量$\mathbf{b}$的$\mathbf{u-v-w}$坐标，我们可以使用向量的点乘运算:
$$
u_b = \mathbf{u \cdot b}; v_b = \mathbf{v \cdot b}; w_b = \mathbf{w \cdot b};
$$
上述表达式成立的前提是对于$u_b, v_b, w_b$，有：
$$
u_b\mathbf{u} + v_b\mathbf{v} + w_b\mathbf{w} =\mathbf{b}
$$
同时点乘运算会将$u_b$坐标单独隔离出来：
$$\begin{aligned}
\mathbf{u \cdot b} &=  u_b\mathbf{(u \cdot u)} + v_b\mathbf{(u \cdot v)} + w_b\mathbf{(u \cdot w)} \\
&=u_b
\end{aligned}$$
由于$\mathbf{u-v-w}$相互垂直，因此上述表达式成立。
在6.2.1和6.5章中，我们将讨论使用矩阵来管理坐标变换。

### 2.4.6 从单个向量中构建基底

通常我们需要一个和给定向量对齐的正交基底。也就是说，给定一个向量$\mathbf{a}$，我们希望获得一组正交基底$\mathbf{u，v，w}$，其中的$\mathbf{w}$的朝向和向量$\mathbf{a}$是一样的（Hughes & Moller, 1999），但是我们并不关心$\mathbf{u，v}$的朝向。仅仅一个向量是无法准确确定一个坐标系的，我们只需要能够稳定找到其中一种情况即可。
我们可以通过如下的叉乘运算来完成。首先构建一个方向和$\mathbf{a}$相同的单位向量$\mathbf{w}$:
$$
\mathbf{w} = \frac{\mathbf{a}}{\Vert \mathbf{a} \Vert}
$$
然后选择一个和$\mathbf{w}$不平行的向量$\mathbf{t}$，并且使用叉乘来构建一个和$\mathbf{w}$垂直的向量$\mathbf{u}$：
$$
\mathbf{t} = \frac{\mathbf{t \times w}}{\Vert \mathbf{t \times w} \Vert}
$$
>同样的构造方法也可以被用于构造三个向量，只要注意叉乘的顺序，以保证符合右手定则即可。

如果$\mathbf{t}$和$\mathbf{w}$平行的话，那么上述式子中的分母就为0了；如果$\mathbf{t}$和$\mathbf{w}$接近平行的话，那么上述式子计算的精度就会大大降低。有一个方法可以简单快速地找到和$\mathbf{w}$明显不同的向量：首先先让$\mathbf{t}$和$\mathbf{w}$相等，然后将$\mathbf{t}$中最小的那个分量变为1。例如：如果$\mathbf{w} = (1/\sqrt{2}, -1/\sqrt{2}, 0)$，那么$\mathbf{t} = (1/\sqrt{2}, -1/\sqrt{2}, 1)$。一旦当我们获得了这样的$\mathbf{w}$和$\mathbf{t}$，那么构建整个基底就很简单了：
$$
\mathbf{v = w \times u}
$$

这种构造方法的一个应用场景是在表面着色中，我们会需要一个和表面发现对齐的向量，但是这个向量围绕发现的旋转通常是不重要的。

### 2.4.7 从两个向量中构建基底

前一节的方法也可以用于基底围绕给定向量旋转很重要的情况。一个很重要的例子是给相机构一组基底：有一个向量需要和相机正在看的方向对齐，但是相机围绕该向量的方向不是任意的，而是需要某种方式来指定它。一旦这个朝向被确定了，那么整个基底都被确定了。
一般通常使用两个向量$\mathbf{a}$（用于指定$\mathbf{w}$）和$\mathbf{b}$（用于指定v）来完全确定一个坐标系。如果这两个向量是相互垂直的，那么可以通过$\mathbf{u = b \times a}$的方式构建第三个向量。
>$\mathbf{u = a \times b}$也可以构建一组标准正交基底，但是这个坐标系是左手系。

为了确保生成的基底是标准正交的（即使输入的向量也不满足正交），一个类似于从单个向量生成标准正交基底的方法是可取的：
$$
\mathbf{w} = \frac{\mathbf{a}}{\Vert \mathbf{a} \Vert},\\[2mm]
\mathbf{t} = \frac{\mathbf{t \times w}}{\Vert \mathbf{t \times w} \Vert}, \\[2mm]
\mathbf{v = w \times u}
$$
事实上，当$\mathbf{a}$和$\mathbf{b}$不垂直的时候，这个方法表现良好。在这种情况下，$\mathbf{w}$的方向会和$\mathbf{a}$完全一致，$\mathbf{v}$是所有和$\mathbf{w}$垂直的向量中，最靠近$\mathbf{b}$的那个。
当$\mathbf{a,b}$共线的时候，这个方法就失效了。在这种情况下，$\mathbf{b}$对于选择和$\mathbf{a}$垂直的方向将毫无帮助：它将垂直于所有方向。
在指定摄像机位置的例子中（章节4.3），我们希望构建一个坐标系，其中的$\mathbf{w}$和摄像机的视线方向相平行，$\mathbf{v}$应该指向摄像机的上方。为了使得相机直立，我们以视线方向为基准构建基底，使用视线的垂直方向来建立围绕视线方向的相机朝向。$\mathbf{v}$需要尽可能地接近直立，以完全符合“保持相机直立”地直观概念。
>如果你希望将$\mathbf{w}$和$\mathbf{v}$设置成两个不垂直的方向，则必须给出——在这个方案中，我会按照你想要的进行设置，除了我将对$\mathbf{v}$做最小的改变，使它实际上和$\mathbf{w}$垂直。

### 2.4.8 建立一个基底

有时你会遇到一些本应该是正交的基底，但是在实际计算中却不是正交的情况——可能是因为舍入误差或者文件存储精度过低所导致的。
可以使用上一节中的方法，利用已经存在的$\mathbf{w,v}$来构建一组新的基底，该基底是标准正交的且和旧的基底非常接近。
这个方法对于很多程序都有用，但是并不是最好的。它确实能够精确地生成标准正交基底，且生成地结果不会和初始基底相差太远。但是相应的：他对于这些基底的“偏爱程度”是不一样的，总会有一个向量的初始值被完全抛弃。这个方法选择了一个和初始正交基很接近的基底，但是它并不能保证是最接近的那个。当这个方法不能满足要求的时候，SVD算法（章节5.4.1）可以用来计算和原始基底最接近的的标准正交基。

## 2.5 曲线和表面

曲线，尤其是曲面集合，在图形学中扮演了中心角色，这里我们回顾一下二维和三维空间中曲线曲面的基础知识。

### 2.5.1 二维隐式曲线

从直觉上来看，曲线是不抬笔在纸上画出来的一系列点的集合。描述曲线最常用的方式是*隐式方程*，二维隐式方程有以下的形式：
$$f(x, y) = 0$$
函数$f(x, y)$返回一个实数值，使得方程值为0的点$(x, y)$在曲线上，使得方程值不为0的点$(x, y)$都不在曲线上。举个例子，假设$f(x, y)$是：
$$
f(x, y) = (x - x_c)^2 + (y - y_C)^2 - r^2 \tag{2.9}
$$
这里的$(x_c, y_c)$是一个二维点，$r$是一个非零实数。如果我们让$f(x, y) = 0$，使得等式成立的点在以$(x_c, y_c)$为圆心，半径为$r$的点上。之所以将这样的方程叫做“隐式”，是因为在曲线上的点$(x, y)$无法从方程中直接计算出来，而是需要通过解方程才能确定。即在曲线上的点不是通过方程*显式*生成的，但是它们都*隐式*隐藏在这个等式中。
很有趣的是，对于所有的$(x, y)$，函数$f$都会返回一个值。我们可以将$f$看成一个地形，其海平面水平位于$f = 0$，而海岸线即为隐式曲线，函数$f$的是海拔高度。另一件需要注意的事情是，曲线将空间划分成了$f > 0, f < 0, f = 0$三部分，因此你可以通过计算$f$来判断一个点是否在曲线内部。请注意，$f(x, y) = c$是对于任意常数c而言的曲线，而$c = 0$只是作为一个约定。例如：如果$f(x, y) = x^2 + y^2 - 1$，改变$c$会生成各种大小不同的同心圆。
我们可以使用向量来简化符号表示，如果我们令$\mathbf{c} = (x_c, y_c), \mathbf{p} = (x, y)$，则使用这些位置向量定义的，圆心在$\mathbf{c}$，半径为$r$的圆满足以下等式：
$$
\mathbf{(p - c) \cdot (p - c) - r^2 = 0}
$$
如果将上述方程代数展开，将会获得等式(2.9)，但是这样可以更容易通过在几何意义上来“阅读”方程，从而看出这是一个描述圆的方程。它可以解读成，“在圆上的点$\mathbf{p}$满足以下性质：从$\mathbf{c}$到$\mathbf{p}$的向量点乘自身会的到值$r^2$”，因为一个向量点乘自身就是它自己长度的平方；或者我们也可以这样解读，“在圆上的点$\mathbf{p}$满足以下性质：从$\mathbf{c}$到$\mathbf{p}$的向量模长的平方为$r^2$”。
更好的是，我们观察到长度的平方刚好是从$\mathbf{c}$到$\mathbf{p}$距离的平方，它说明了：
$$\Vert \mathbf{p - c} \Vert^2 - r^2 = 0$$
当然，它也说明了：
$$\Vert \mathbf{p - c} \Vert - r = 0$$
上述表达式可以解读成“点$\mathbf{p}$是到圆心$\mathbf{c}$距离为$r$的点”，这和其他对于圆的定义一样好。这说明向量化的方程通常比具有$x, y$的全笛卡尔形式表现出更好的几何属性和直觉。因此在可能的情况下，通常都建议使用向量形式。除此之外，你可以在代码中为专门向量设置一个类，当使用向量形式的时候，代码会变得更加整洁。面向向量的等式通常在实现中也不容易出错：一旦你在代码中实现并调试好了向量类型之后，对于$x, y, z$的复制错误将不复存在。你需要花费一点时间来熟悉这些方程中的向量，但是一旦你熟悉了它，它会给你带来很大的汇报。

### 2.5.2 二维梯度

如果我们将函数$f(x, y)$视为一个高度长，其中高度=$f(x, y)$，那么其中的*梯度*向量指向了最大上坡的方向，例如笔直上坡。梯度向量$\nabla f(x, y)$的定义如下：
$$
\nabla f(x, y) = (\frac{\partial f}{\partial x}, \frac{\partial f}{\partial y})
$$
隐式曲线$f(x, y) = 0$上的某个点的梯度向量垂直于该点上曲线的切向量。这个垂直的向量通常叫做曲线的*法向量*。除此之外，由于梯度指向上坡的方向，因此它指明了$f(x, y) > 0$区域的方向。
![图2.24](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202204281950099.png)
>**图2.24**：存在一个表面，其高度$= f(x, y)$。在$(x, y) = (a, b)$附近，其梯度为梯度为上坡方向在高度为0的平面上的投影。

在高度场的背景中，偏导数和梯度的几何意义会比通常情况更明显。假设在点$(a, b)$的附近，$f(x, y)$是一个平面（如图2.24），这里有一个明确的上坡和下坡的方向，与这个方向成直角的是相对于平面的水平的。该平面与$f(x, y) = 0$之间的任何交点都在这个水平方向上，即上坡/下坡方向都会和交点线$f(x, y) = 0$垂直。为了看出偏导数为什么和这些有关，我们需要可视化它的几何意义。首先回顾一下一维函数$y = g(x)$的常规导数：
$$
\frac{\mathrm{d}y}{\mathrm{d}x} \equiv \lim_{\Delta x \to 0}\frac{\Delta y}{\Delta x} = \lim_{\Delta x \to 0} \frac{g(x + \Delta x) - g(x)}{\Delta x} \tag{2.10}
$$
一维函数的导数即函数切线的斜率(图2.25)。
![图2.25](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202204291223388.png)
>**图2.25**：一维函数的导数描述了曲线切线的斜率。

偏导数是一维导数的一般化形式，对于一个二位函数$f(x, y)$而言，我们无法像方程(2.10)中那样对$x$进行限制，因为对于一个给定的$x$，$f$的值还是会不断变化。但是如果我们保持$y$的值不变，我们可以定义一个对导数的模拟，这就叫做*偏导数*（图2.26）：
$$
\frac{\partial f}{\partial x} = \lim_{\Delta x \to 0} \frac{f(x + \Delta x, y) - f(x, y)}{\Delta x}
$$
![图2.26](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202204291231780.png)
>**图2.26**：函数$f$关于$x$的偏导必须保持$y$不变，如图中的黑色实心点。空心点代表了没有保持$y$不变时函数$f$的其他值。

那为什么对$x, y$的偏导数是梯度的分量呢？同样的，相对于代数形式，从几何角度观察则更容易理解。在图2.27中，我们可以看到向量$\mathbf{a}$沿着函数$f$没有发生变化的方向。请再次注意，这也是一个足够小的范围，即表面高度$(x, y) = f(x, y)$附近可以被认为是一个平面。从图中我们可以看出$\mathbf{a} = (\nabla x, \nabla y)$。
![图2.27](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202204291235416.png)
>**图2.27**：向量$\mathbf{a}$指向了函数$f$没有发生变化的方向，即垂直于梯度向量$\nabla f$的方向。

由于上坡的方向（梯度方向）和$\mathbf{a}$垂直，因此我们可以得知它俩的点乘结果为0:
$$
(\nabla f) \cdot \mathbf{a} = (x_\nabla, y_\nabla) \cdot (x_a, y_a) = x_\nabla \Delta x + y_\nabla \Delta y = 0 \tag{2.11}
$$
我们也可以得知函数$f$在$(x_a, y_a)$方向上的变化也为0：
$$
\Delta = \frac{\partial f}{\partial x} \Delta x + \frac{\partial f}{\partial y} \Delta y \equiv \frac{\partial f}{\partial x}x_a +\frac{\partial f}{\partial y}y_a = 0
$$
对于给定的一组相互垂直的向量$(x, y)$和$(x^\prime, y^\prime)$，其夹角为90度，即它们的点乘结果为0（回想一下两个向量点乘的结果和它们之间的夹角正弦值成正比），也就是说，有$xx^\prime + yy^\prime = 0$。对于一个已知的向量$(x, y)$，可以很容易地构建出与其点乘结果为0的向量，两个最明显的结果就是$(y, -x)$和$(-y, x)$，你可以将其和$(x, y)$点乘来验证结果。总而言之，向量$(x, y)$会垂直于向量$k(y, -x)$，其中k是一个不为0的常量。这意味着：
$$
((x_a, y_a)) = k(\frac{\partial f}{\partial y}, -\frac{\partial f}{\partial x}) \tag{2.12}
$$
将方程(2.11)和(2.12)联立，可得：
$$
(x_\nabla, y_\nabla) = k^\prime (\frac{\partial f}{\partial x}, -\frac{\partial f}{\partial y})
$$
上述方程中的$k^\prime$是任何不为0的常量。根据定义可得，“上坡”方向表面了函数$f$的正向变化，因此我们期望$k^\prime > 0$，通常来说$k^\prime = 1$是一个不错的约定。
举一个梯度的例子，考虑一个梯度向量为$2x, 2y$的隐式圆方程$x^2 + y^2 - 1 = 0$，它表面了圆的外部是函数$f(x, y) = x^2 + y^2 - 1$的正区域。请注意，梯度向量的长度会因为隐式方程中的乘数而变得不同。例如，对于任意非零的A，单位圆可以表示成$Ax^2 + Ay^2 - A = 0$，该曲线的梯度是$(2Ax, 2Ay)$，它将是圆的法线（垂直），但是将由$A$来决定它的长度。对于$A > 0$，这个法线将会指向圆的外部；对于$A < 0$，它将指向圆的内部。这种从外向内的切换是应该的，因为圆的正区域也切换到了内部。从高度场方面来看，$h = Ax^2 + Ay^2 - A$，圆刚好是海拔为0的地方。对于$A > 0$，圆包围了一块洼地；对于$A < 0$，圆包围了一块凸起。当$A$持续负增长的时候，中间的突起也会增加它的高度，但是在圆还是在$h=0$地方，不会改变。最大上坡方向也不会改变，但是它的斜率增加了，梯度的长度在斜率角度上反应了这种变化。所以从直觉上，你可以认为梯度的方向指向了最大上坡方向，它的大小反映了上坡的陡峭程度（坡度）。

#### 隐式二维线条

直线的截距式方程有如下熟悉的形式：
$$y = mx + b \tag{2.13}$$
它可以很容易的被转换为隐式方程的形式：
$$y - mx - b = 0 \tag{{2.14}}$$
这里的$m$是斜率（上升与移动的比值），$b$是直线和$y$轴交点，通常被叫做截距。这条线同样分割了整个二维平面，但是在直觉上更符合“上下”之分，而不是“内外”之分。
由于我们可以将隐式方程和任意常量相乘而不改变它的零点，即对于任意不为0的$k$而言，$kf(x, y) = 0$表示的是同一条直线。这允许一条直线具有几种隐式形式，例如：
$$2y - 2mx - 2b = 0$$
截距式有时候会遇到一些尴尬的情况，其中一个原因是它不能表示所有的直线，比如对于$x = 0$这条直线来说，它的$m$是无穷大的。因此，使用直线的一般式是很有用的：
$$Ax + By + C = 0 \tag{2.15}$$
其中的$A, B, C$都是实数。
假设我们已知直线上的两点$(x_0, y_0)和(x_1, y_1)$。那什么样的参数$A, B, C$才能描述这条直线呢？由于这些点都在直线上，因此它们都满足方程(2.15)：
$$
Ax_0 + By_0 + C = 0 \\
Ax_1 + By_1 + C = 0
$$
不幸的是，我们只有两个方程，但是却有三个未知数。这个问题出现的原因是我们可以将隐式方程和任意的乘数相乘。为了方便，我们将C设置成1，即：
$$Ax + By + 1 = 0$$
但是这里我们会遇到一个和截距式相同的问题，那就是当斜率无穷大的时候：穿过原点的直线需要满足$A(0) + B(0) + 1 = 0$，这个等式是不成立的。举个例子：以45度角穿过原点的直线可以被写成$x - y = 0$或者$y - x= 0$，甚至是$17y - 17x= 0$，但是它无法被写成$Ax + By + 1 = 0$的形式。
当我们遇到类似这样的几何问题的时候，我们可以尝试将几何直觉来帮助理解。其中一个工具就是我们在章节2.5.2中讨论的梯度。对于直线$Ax + By + C = 0$而言，他的梯度是$(A,B)$，这是一个垂直于直线的向量（图2.29），指向了$Ax + By + C > 0$的区域。
![图2.29](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202204302153005.png)
>**图2.29**：梯度向量$(A,B)$垂直于隐式直线$Ax + By + C = 0$。

对于直线上给定的两个点$(x_0, y_0)和(x_1, y_1)$，我们可以知道两点之间的向量和整个直线的方向是一致的。即向量$(x_1 - x_0, y_1 - y_0)$平行于该直线，因此它和梯度向量$(A,B)$一定是垂直的。回顾一下，由于隐式直线可以被任意的缩放，因此存在无限个$(A, B, C)$的有效组合，而我们只需要找到其中一个即可。
我们可以从任意梯度向量$(A, B)$都垂直于$(x_1 - x_0, y_1 - y_0)$这个条件出发。符合要求的$(A, B)$可以是$(y_0 - y_1，x_1 - x_0)$（详见章节2.5.2），对于穿过$(x_0, y_0)和(x_1, y_1)$的直线而言，它意味着：
$$
(y_0 - y_1)x + (x_1 - x_0)y + C = 0 \tag{2.16}
$$
现在我们只需要得知$C$的值即可，由于点$(x_0, y_0)和(x_1, y_1)$都在直线上，因此它们都满足方程(2.16)，因此我们可以带入其中任意一个来解出$C$。将$(x_0, y_0)$带入方程，解得$C = x_0y_1 - x_1y_0$，于是该直线的完整方程便是：
$$
(y_0 - y_1)x + (x_1 - x_0)y + x_0y_1 - x_1y_0 = 0 \tag{2.17}
$$
同样的，对于穿过两个点的直线，这只是无数有效的隐式方程中的其中一个，但是这个形式不包含除法运算，而且对于有限笛卡尔坐标中的点，也没有数值退化的情况。我们也可以通过将方程(2.17)中的非$y$项移动到等号右边，然后等号两边同除以$y$的系数，从而将其转换为一个截距式（如果它存在的话）：
$$
y = \frac{y_1 - y_0}{x_1 - x_0}x + \frac{x_1y_0 - x_0y_1}{x_1 - x_0}
$$
![图2.30](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202205011158128.png)
>**图2.30**：隐式函数$f(x, y) = Ax + By + C$的值是到直线$Ax + By + C = 0$的有向距离的常数倍。

对于直线的隐式方程来说，有一个很有趣的性质，那就是可以用来计算一个点到直线的有向距离。$Ax + By + C$的值和该点到直线的距离成正比（图2.30）
![图2.31](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202205011202850.png)
>**图2.31**：向量$k(A, B)$连接点$a$和直线上距离点$a$最近的一点，距离和$k$成正比。

如图2.31所示，点到直线的距离是向量$k(A, B)$的长度，即：
$$
distance = k \sqrt{A^2 + B^2} \tag{2.18}
$$
对于点$(x, y) + k(A, B)$而言，函数$f(x, y) = Ax + By + C$的值为：
$$\begin{aligned}
f(x + kA, y + kB) &= Ax + kA^2 + By + kB^2 + C \\
&=k(A^2 + B^2) \tag{2.19}
\end{aligned}$$
这个方程可以化简是因为我们已知$(x, y)$在直线上，所以$Ax_0 + By_0 + C = 0$。联立方程(2.18)和(2.19)，我们可以看出，点$(a, b)$到直线$Ax_0 + By_0 + C = 0$的有向距离是：
$$
distance = \frac{f(a, b)}{\sqrt{A^2 + B^2}}
$$
这里的有向距离是指它的大小（绝对值）代表了的几何距离，当在直线的某一边的时候，有向距离为正，其他情况下有向距离都为负数。如果你需要指定特定的一边为正，你可以在两个等效表达式$f(x, y) = 0$和$-f(x, y) = 0$之间进行选择。需要注意的是，如果$(A, B)$是单位向量的话，$f(a, b)$的值才是有向距离。我们可以将方程(2.17)乘以一个常量系数，来保证$(A, B)$是一个单位向量：
$$
f(x,y) = \frac{y_0 - y_1}{\sqrt{(x_1 - x_0)^2 + (y_0 - y_1)^2}}x + \frac{x_1 - x_0}{\sqrt{(x_1 - x_0)^2 + (y_0 - y_1)^2}}y
\\+ \frac{x_0y_1 - x_1y_0}{\sqrt{(x_1 - x_0)^2 + (y_0 - y_1)^2}}x = 0 \tag{2.20}
$$
我们注意到，方程(2.20)中的$f(x, y)$直接给出了有向距离，但是他需要计算一个平方根来求解方程。隐式直线对于三角形的光栅化（章节8.1.2）特别有用。其他形式的二维直线会在章节14中进行讨论。

#### 隐式二次曲线

在之前的章节中我们看到一个线性函数$f(x, y)$给出了一个隐式直线$f(x, y)$。如果$f$是一个关于$x, y$的二次函数，其一般形式为：
$$
Ax^2 + Bxy + Cy^2 + Dx + Ey + F = 0
$$
这样的隐式曲线叫做二次曲线。二次曲线包括椭圆和双曲线，还要一些特殊情况如抛物线，圆和直线。
二次曲线的例子包括了以$(x_c, y_c)$为圆心，班级为$r$的圆：
$$
(x - x_c)^2 + (y - y_c)^2 - r^2 = 0
$$
还有轴对齐的椭圆：
$$
\frac{(x - x_c)^2}{a^2} + \frac{(y - y_c)^2}{b^2} - 1 = 0
$$
其中的$(x_c, y_c)$是椭圆的中心，$a, b$分别是椭圆的长轴和短轴
>当$a = b = r$的时候，上述椭圆方程就变成了圆方程。

### 2.5.3 三维隐式表面

就像隐式方程可以在二维下定义曲线一样，它在三维中也可以用来定义表面。跟在二维中一样，隐式方程*隐式*地定义了一个在表面上地点集：
$$f(x, y, z) = 0$$
表面上地任意一点$(x, y, z)$带入函数$f$都会使得结果为0；不在表面上的点带入等式产生的值不为0。你可以通过将一点带入函数$f$进行计算，来检查该点是否在表面上，或者通过函数的值来判断该点在表面的哪一侧，但是你缺无法显式的构建表面上的点。使用向量符号$\mathbf{p} = (x, y, z)$，我们可以将之前的方程改写成如下形式：
$$f(\mathbf{p}) = 0$$

### 2.5.4 隐式表面的表面法线

表面法线是一个垂直于表面的向量，用于光照计算等操作。表面上的每一个点都会有不同的法线。二维表曲线的梯度提供了曲线的向量，和二维中的情况类似，表面上的一点$p$的法线可以通过隐式函数的梯度得到：
$$
\mathbf{n} = \nabla f(\mathbf{p}) = \left( \frac{\partial f(\mathbf{p})}{\partial x}, \frac{\partial f(\mathbf{p})}{\partial y}, \frac{\partial f(\mathbf{p})}{\partial z} \right)
$$
和二维中的原因一样：梯度指向了函数$f$增长最快的方向，该方向垂直于表面所有的切向量，其中$f$保持不变。梯度向量指向了$f(\mathbf{p}) > 0$的区域，在一个给定的上下文中，我们可以认为它是“进入”表面或者“离开”表面。如果特定形式的$f$产生了向内的梯度向量，但是你需要一个向外的梯度向量，你可以选择$-f(\mathbf{p}) = 0$而不是$f(\mathbf{p}) = 0$，它们用于方向相反的梯度向量，即：$-\nabla f(\mathbf{p} = \nabla( -f(\mathbf{p}))$。其他的则完全相同。

### 2.5.5 隐式平面

举个例子，考虑穿过点$\mathbf{a}$的一个无限平面，它的表面法线是$\mathbf{n}$，我们可以用以下的隐式方程来描述这样的一个平面：
$$(\mathbf{p - a) \cdot n} = 0 \tag{2.21}$$
![图2.33](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202205011417884.png)
>**图2.33**：如果满足方程(2.2)，则任意一点$\mathbf{p}$都在经过点$\mathbf{a}$，法线为$\mathbf{n}$的平面上。

请注意$\mathbf{a,n}$都是已知量，点$\mathbf{p}$是一个满足方程的未知点。这个方程从几何角度描述了：从$\mathbf{a}$指向$\mathbf{p}$的垂直于平面的法线。如果$\mathbf{p}$不在表面上的话，$\mathbf{p - a}$和$\mathbf{n}$之间的夹角不可能是一个直角（图2.33）。
有时我们希望获得一个同时穿过点$\mathbf{a, b, c}$三点的平面，该表面的法线可以通过平面上的两个向量进行叉乘获得，其中一个叉乘如下：
$$
\mathbf{n = (b - a) \times (c - a)}
$$
有了平面穿过的点和法线，我们就可以写出平面的隐式方程：
$$
\mathbf{(p - a) \cdot((b - a) \times (c - a))} = 0 \tag{2.22}
$$
从几何角度来理解这个方程的一个方法是：由向量$\mathbf{p - a, b - a, c - a}$所决定的平行六面体的体积是0，即三个向量是共面的，只有当点$\mathbf{p}$和$\mathbf{a, b, c}$在同一个平面的时候以上结论才成立。完整的笛卡尔表示是由行列式给出的（将在章节5.3中仔细讨论）：
$$
\left| \begin{matrix}
x - x_a & y - y_a & z - z_a \\
x_b - x_a & y_b - y_a & z_c - z_a \\
x_c - x_a & y_c - y_a & z_c - z_a
\end{matrix}\right | = 0 \tag{2.23}
$$
这个行列式可以被展开成具有很多项的多项式（有关行列式展开的部分详见章节5.3）。
方程(2.22)和(2.23)是等价的，将它们放在一起进行比较是有帮助的。方程(2.22)很容易从几何的角度来理解，且可以用于编写高效率的代码。除此之外，如果利用已经调试好的点乘和叉乘代码，可以相对容易的避免因拼写错误而产生的错误代码。方程(2.23)也很容易从几何的角度来理解，如果你已经实现了$3 \times 3$的行列式函数，那么使用这种形式也是很高效的。如果有一个行列式函数$determinant(\mathbf{a, b, c})$的话，可以在很大程度上避免拼写错误的。如果你将函数*determinant*重命名为*volume*，那么对于其他人来说，会大大增强代码的可读性。因此方程(2.22)和(2.23)都可以很好的映射到代码中。将任何方程完全展开到$x, y, z$分量都很可能产生拼写错误，而且这种拼写错误很可能还会通过编译，这是令人非常讨厌的。整洁的数学公式产生整洁的代码，臃肿的数学公式产生臃肿的代码，这便是一个很好的例子。

#### 三维二次曲面

就像在二维空间中，包含两个变量的二次多项式定义了二次曲线；在三维空间中，包含$x, y, z$的二次多项式定义了*二次曲面*。例如，一个球体可以被写成如下形式：
$$
f(\mathbf(p)) = (\mathbf(p - c))^2 - r^2 = 0
$$
轴对齐的椭圆可以被写成：
$$
f(\mathbf(p)) = \frac{(x - x_c)^2}{a^2} + \frac{(y - y_c)^2}{b^2} + \frac{(z - z_c)^2}{c^2} - 1 = 0
$$

#### 隐式表面中的三维曲线

有人可能会希望从形如$f(\mathbf(p)) = 0$的函数中生成三维隐式曲线。但是所有这样的曲线都退化成了推免，而且在实践中很少使用。一个三维曲线可以通过联立两个隐式方程产生的交点来产生：
$$
f(\mathbf(p)) = 0,\\
g(\mathbf(p)) = 0
$$
例如，两个隐式平面相交可以产生一条三维直线。通常，使用参数化的曲线会更加方便，我们将在后续的章节中进行讨论。

### 2.5.6 二维参数化曲线

一个*参数化*曲线被一个单独的参数控制，它可以被看作一个沿着曲线联系移动的索引。这样的曲线有如下形式：
$$\left [ \begin{matrix}
x \\
y
\end{matrix} \right ] =
\left [ \begin{matrix}
g(t) \\
h(t)
\end{matrix} \right ]$$
这里的$(x, y)$是曲线上的点，$t$是影响曲线的参数。对于一个给定的参数$t$，函数$g, h$会决定生成的点。对于连续的$g, h$而言，$t$的变化会相应的引起$x, y$的变化。即对于一个连续的参数$t$，生成的点会组成一条连续的曲线。这是一个很好的特性，因为我们可以使用参数$t$来显式生成曲线上的点。通常我们会将一个参数化曲线写成向量形式：
$$\mathbf{p} = f(t)$$
其中的$f(t)$是一个返回向量结果的函数，即$f: \mathbb{R \mapsto R^2}$。这样的向量函数可以生成非常整洁的代码，在允许的情况下，应该尽可能地使用这种形式。
我们可以将跟位置有关的曲线看成一个与时间有关的函数。这个曲线可以去任何地方，可以产生循环或者穿过自己。我们也可以认为曲线在任何一点上都具有速度。例如：点$\mathbf{p}(t)$在$t = -2$的时候移动缓慢，在$t = 2和t = 3$的时候移动迅速。这种“移动点”的术语经常被用来讨论参数化的曲线，即使曲线并没有在描述一个移动点。

#### 二维参数化直线

一个穿过点$\mathbf{p}_0 = (x_0, y_0)和\mathbf{p}_1 = (x_1, y_1)$参数化直线可以被写成：
$$
\left [ \begin{matrix}
x \\
y
\end{matrix} \right ] =
\left [ \begin{matrix}
x_0 +t(x_1 - x_0)  \\
y_0 +t(y_1 - y_0)
\end{matrix} \right ]
$$
![图2.34](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202205011828096.png)
>**图2.34**：一个穿过$\mathbf{p}_0，\mathbf{p}_1$的参数化直线，由$t \in [0,1]$定义的线段如图中加粗部分所示。

由于$x, y$对应的公式是类似的，因此我们可以使用$\mathbf{p} = (x, y)$来将上述方程改写成向量形式（图2.34）：
$$\mathbf{p} t = \mathbf{p}_0 + t(\mathbf{p}_1 - \mathbf{p}_0)$$
你可以从几何角度将其理解成：从点$\mathbf{p}_0$出发，然后由参数$t$决定向点$\mathbf{p}_1$前进一段距离。这种形式的一种特性是$\mathbf{p}(0) = \mathbf{p}_0, \mathbf{p}(1) = \mathbf{p}_1$。由于点随着参数$t$线性变化，因此$\mathbf{p}_0，\mathbf{p}_1$之间的$t$值衡量了各点之间的分数距离。$t < 0$的点在$\mathbf{p}_0$的“远”侧；$t > 1$的点在$\mathbf{p}_1$的“远”侧。
参数化曲线也可以用一个点$\mathbf{o}$和一个向量$\mathbf{d}$来描述：
$$
\mathbf{p}(t) = \mathbf{o} + t\mathbf{d}
$$
当向量$\mathbf{d}$是单位向量的时候，那么这条直线是*弧长参数化(arc-length parameterized)*的。它意味着$t$精确度量了沿着直线的距离。任何参数化曲线都可以是弧长参数化的，这是一个非常方便的形式，但是并不是所有参数化曲线都可以使用解析法转换。

#### 二维参数化圆

以$(x_c, y_c$为圆心，$r$为半径的参数化圆有以下形式：
$$
\left [ \begin{matrix}
x \\
y
\end{matrix} \right ] =
\left [ \begin{matrix}
x_c + r \cos \phi  \\
y_c + r \sin \phi
\end{matrix} \right ]
$$
为了确保每一个点都对应唯一一个参数$\phi$，我们可以限制它的定义域$\phi \in [0, 2\pi)$或者$\phi \in (-\pi, \pi]$，或者其他任何长度为$2\pi$的半开区间。
我们可以通过对$x, y$参数分别进行缩放来构建一个轴对齐的椭圆参数方程：
$$
\left [ \begin{matrix}
x \\
y
\end{matrix} \right ] =
\left [ \begin{matrix}
x_c + a \cos \phi  \\
y_c + b \sin \phi
\end{matrix} \right ]
$$

### 2.5.7 三维参数化曲线

三维参数化曲线的操作方式和二维参数化曲线类似：
$$
x = f(t), \\ t = g(t), \\ z = h(t).
$$
例如，一个绕$z$轴旋转的螺旋线可以写作：
$$
x = \cos t, \\ t = \sin t, \\ z = t.
$$
和二维曲线一样，如果我们想控制曲线的起点和终点，那么$f, g, h$都是定义在$D \subset \mathbb{R}$上的函数。我们也可以将其写成向量的形式：
$$
\left [ \begin{matrix}
x \\ y \\ z
\end{matrix} \right ] = \mathbf{p}(t)
$$
>参数化曲线便是函数$\mathbf{p}$的值域：$\mathbb{R \to R^3}$

在本章中我们只是讨论了三维曲线，有关如何生成三维参数化曲线的部分将会在章节15中深入讨论。

#### 三维参数化直线

我们可以直接对二维参数化曲线进行拓展，将其转变成三维参数化曲线，例如：
$$
x = 2 + 7t, \\ y = 1 + 2t, \\ z = 3 - 5t.
$$
上面的方程组非常冗长，而且不易于代码实现，因此我们可以将其写成向量形式：
$$\mathbf{p = o} + t\mathbf{d}$$
在这个例子中，$\mathbf{o, d}$分别是：
$$
\mathbf{o} = (2, 1, 3), \\ \mathbf{d} = (7, 2, -5).
$$
这和二维中的情况类似，我们可以将其想象成穿过点$\mathbf{o}$的直线和向量$\mathbf{d}$平行。对于给定的参数$t$，你可以获得在直线上的点$\mathbf{p}(t)$。例如：当$t = 2$时，$p(t) = (2, 1, 3) + 2(7, 2, -5) = (16, 5, -7)$。这个概念和二维中的情况是一样的（图2.30）。
和二维一样，可以通过一个参数化直线和一个区间$t \in [t_a, t_b]$来定义一个线段。$\mathbf{a, b}$之间的线段可以表示成$\mathbf{p}(t) = \mathbf{a} + t\mathbf{b - a}$，$t \in [0, 1]$。其中$\mathbf{p}(0) = \mathbf{a}, \mathbf{p}(1) = \mathbf{b}$，还有$\mathbf{a, b}$的中点$\mathbf{p}(0.5) = \mathbf{(a + b)/2}$。
一条*射线*，或者叫做*半直线*，是一个具有半开区间的三维参数化直线，通常这个半开区间都是$[0, \infty)$。从现在开始，我们将所有的直线，线段或者射线统称为“射线”。这是草率的，但是大家一般都这么使用，这可以让讨论变得简单一些。

### 2.5.8 三维参数化表面

和曲线定义一样，这种参数化方法也可以用来定义三维空间中的表面，它使用了两个参数来定位表面的二维区域。这些参数化表面有以下形式：
$$
x = f(u, v), \\ t = g(u, v), \\ z = h(u, v).
$$
或者将其写成向量形式：
$$
\left [ \begin{matrix}
x \\ y \\ z
\end{matrix} \right ] = \mathbf{p}(u, z).
$$
>参数化表面便是函数$\mathbf{p}$的值域：$\mathbb{R^2 \to R^3}$

#### 例子

例如地球表面上的一点可以通过经度和纬度两个参数来描述。如果定义原点在地球的中心，$r$代表地球的半径，我们可以构建一个以原点为中心的球坐标系，它的参数方程如下：
$$
x = r \cos \phi \sin \theta, \\
y = r \sin \phi \sin \theta, \\
z = r \cos \theta. \tag{2.24}
$$
![图2.35](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202205021209302.png)
> **图2.35**：球坐标系的几何表示。
> 这里为了方便论证，假设地球是一个正球体。
> 这里$\phi , \theta$的顺序在不同的学科中可能是不一样的。在本书中，我们始终假设$\phi , \theta$符合方程(2.24)和图2.35中的含义。

理想状态下，我们希望可以将其写成向量形式。但是对于这样的参数化方程我们没法将其写成向量形式。
对于一个给定的$(x, y, z)$，我们希望能找到一组满足方程的$(\phi , \theta)$。如果我们假设$\phi \in (-\pi, \pi]$，那么我们可以利用方程(2.2)中的$atan2$函数很容易的将其计算出来：
$$
\theta = \arccos(z / \sqrt{x^2 + y^2 + z^2}), \\
\phi = atan2(y, x). \tag{2.25}
$$
对于隐式表面，函数$f$的导数给出了表面的法线。对于参数化曲面，$\mathbf{p}$的导数也给出了表面的几何信息。
考虑函数$\mathbf{q}(t) = \mathbf{p}(t, v_0)$，这个函数通过保持$v = v_0$的同时改变$u$，从而定义了一个参数化曲线，这个曲线叫做表面的*等参曲线*。函数$\mathbf{q}$的导数给出了曲线的一个切向量，由于等参曲线位于表面上，因此$\mathbf{q}^\prime$也位于表面上。因为曲线$\mathbf{q}$是通过改变$\mathbf{p}$的一个参数得到的，因此$\mathbf{q}^\prime$是$\mathbf{p}$对$u$的偏导，记作$\mathbf{p}_u$。同理，偏导数$\mathbf{p}_v$给出了常数$u$的等参曲线的切线，这是表面的第二个切向量。
$\mathbf{p}$的导数，给出了表面上任意一点的两个切向量，该表面的法线可以通过切向量的叉乘获得：两个切向量的叉乘结果垂直于这两个切向量，即垂直于该表面。叉乘的右手定则决定了哪一边是表面的前侧或者外侧。该表面的法向量如下：
$$\mathbf{n} = \mathbf{p}_u \times \mathbf{p}_v$$
该向量指向了表面的外部。

### 2.5.9 曲线和表面的总结

二维空间中的隐式曲线和三维空间中的隐式表面的是由两个或者三个变量的标量函数定义的，即$f: \mathbb{R^2 \to R}$或$f: \mathbb{R^3 \to R}$，表面是由使得函数值为0的点构成的：
$$S = \{\mathbf{p} | f(\mathbf{p}) = 0\}$$
二维或者三维空间中的参数化曲线是由只有一个变量的向量函数定义的，即$\mathbf{p}: D \subset \mathbb{R \to R^2}$或$\mathbf{p}: D \subset \mathbb{R \to R^3}$，曲线是由$t$在$D$上变化时扫出的点构成的：
$$S = \{\mathbf{p}(t) | t \in D\}$$
三维空间中的参数化曲面是由包含两个变量的向量函数定义的，即$\mathbf{p}: D \subset \mathbb{R^2 \to R^3}$，表面由定义域中的所有点$(u, v)$的像构成的：
$$S = \{\mathbf{p}(t) | (u, v) \in D\}$$
对于隐式的曲线和表面，其法向量由函数$f$的导数（梯度）给出，切向量可以通过由法向量构建的基底得到。
对于参数化的曲线和表面，其切向量由函数$\mathbf{p}$的导数给出，法向量可以通过由切向量构建的基底得到。

## 2.6 线性插值

图形学中最常见的数学操作可能就是线性插值。之前我们已经看到了在二维或者三维空间中对位置进行线性插值形成线段的例子了，点$\mathbf{a, b}$被参数$t$联系在一起，形成了线段$\mathbf{p} = (1 - t)\mathbf{a} + t\mathbf{b}$。这是一种插值是因为$\mathbf{p}$在$t = 0, t = 1$的时候穿过了$\mathbf{a, b}$，这个插值是线性的是因为权重项$t, 1 - t$是$t$的线性多项式。
另一个常见的线性插值是在$x$轴上的一组点$x_0, x_1, \ldots, x_n$进行的，对于每一个$x_i$，都有一个对应的高度$y_i$。我们希望构建一个连续函数$y = f(x)$来对这些位置进行插值，使得函数$f$经过每一个数据点，即$f(x_i) = y_i$。对于线性插值，这些点$(x_i, y_i)$会被直线段两两连接，对于这些分段使用直线参数方程是很自然的，参数$t$是$x_i, x_{i + 1}$之间的分数距离：
$$
f(x) = y_i + \frac{x - x_i}{x_{i+1} - x_i}(y_{i+1} - y_i) \tag{2.26}
$$
由于权重函数是$x$的线性多项式，因此这是一个线性插值。
以上两个例子都是线性插值的常见形式，我们创建一个在0到1之间变化的变量$t$来控制从数据项A到数据项B的移动，中间的数据项为$(1 - t)A + tB$。请注意，公式(2.26)就是这种形式，其中的$t$为：
$$
t = \frac{x - x_i}{x_{i+1} - x_i}
$$

## 2.7 三角形

在很多图形程序中，二维或者三维空间中的三角形是基础的建模单元。通常，颜色等其他信息都被标记到三角形的顶点上，这些信息在三角形内部会进行插值。使用三角形的重心坐标可以使得这些插值变得简单明了，我们将从头开始研究这些内容。我们也会讨论二维平面上的三角形，这些知识可以帮助你理解如何将它们绘制在2D屏幕上。

### 2.7.1 二维三角形

如果我们使用点$\mathbf{a, b, c}$来定义二维平面上的一个三角形，我们首先可以计算出它的面积：
$$\begin{aligned}
area &= \frac{1}{2}
\left | \begin{matrix}
x_b - x_a & x_c - x_a \\
y_b - y_a & y_c - y_a
\end{matrix} \right | \\[2mm]
&= \frac{1}{2}(x_ay_b + x_by_c + x_cy_a - x_ay_c - x_by_a - x_cy_b)
\end{aligned} \tag{2.27}$$
上述公式的推导方法详见章节5.3。如果点$\mathbf{a, b, c}$是逆时针排列的，那么这个计算出的面积就是正的；反之是一个负数。
通常在图形学中，我们希望在每个三角形定点上分配一个属性，如颜色，并在整个三角形上对该属性进行平滑的插值。有很多方法可以实现这一点，其中最简单有效的就是使用重心坐标。一种考虑重心坐标的方式是将其看作一个我们在章节2.4.2中简要讨论过的非正交坐标系。图2.36展示了这样的一个非正交坐标系，其中点$\mathbf{a}$是原点，点$\mathbf{c - a, b - a}$分别是坐标系的两个基向量。
![图2.36](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202205021502194.png)
> **图2.36**：一个以$\mathbf{a, b, c}$为顶点的平面三角形可以用来构建一个非正交的坐标系，其中点$\mathbf{a}$是原点，点$\mathbf{(c - a), (b - a)}$分别是坐标系的两个基向量。该坐标系中的点可以表示成一个有序数对$(\beta, \gamma)$。例如：点$\mathbf{p} = (2.0, 0.5)$在该坐标系下可以表示成：$\mathbf{p} = \mathbf{a} + 2.0(\mathbf{b - a}) + 0.5(\mathbf{c - a})$

有了原点和基向量，我们可以将平面上的任意一点$\mathbf{p}$写成：
$$
\mathbf{p} = \mathbf{a} + \beta (\mathbf{b - a}) + \gamma (\mathbf{c - a}) \tag{2.28}
$$
我们可以将方程(2.28)进行化简，得到：
$$
\mathbf{p} = (1 - \beta - \gamma) \mathbf{a} + \beta \mathbf{b} + \gamma \mathbf{c}
$$
有时候人们会定义一个新的变量$\alpha$来使得方程更加整洁：
$$\alpha \equiv 1 - \beta - \gamma$$
方程的最终形式为：
$$
\mathbf{p}(\alpha, \beta, \gamma) = \alpha\mathbf{a} + \beta\mathbf{b} + \gamma\mathbf{c} \tag{2.29}
$$
方程中的参数有以下限制条件：
$$\alpha + \beta + \gamma = 1 \tag{2.30}$$
重心坐标乍一看是一个很抽象，很不直观的概念，但是它是非常强大且方便的。城市中有两组平行的街道，但是相交街道之间的夹角并不是直角，在这样的场景下思考街道地址的工作方式有可能帮助你理解重心坐标的概念。生活中的很多坐标系的本质都是重心坐标，你将很快的适应它们。重心坐标对于平面上的所有点都有定义，它有一个非常棒的特性，那就是点$\mathbf{p}$在以点$\mathbf{a, b, c}$构成的三角形的内部的条件是当且仅当：
$$
0 < \alpha < 1, \\ 0 < \beta < 1, \\ 0 < \gamma < 1.
$$
如果其中一个坐标为0，而另外两个坐标介于0和1之间，那么这个点位于三角形的一条边上；如果两个坐标为0，剩下的那个坐标为1，那么该点就是三角形的一个顶点。重心坐标另一个很好的特性是，方程(2.29)实际上以一种平滑的方式混合了三点的坐标。相同的混合系数$(\alpha, \beta, \gamma)$也可以用来混合其他属性，例如颜色等，我们将在下一章节看到它的应用。
对于一个给定的点$\mathbf{p}$，我们如何计算它的重心坐标呢？一种方式是将方程(2.28)写成以$\beta, \gamma$为未知数的线性方程组形式，然后求解方程，最后令$\alpha \equiv 1 - \beta - \gamma$，矩阵形式的线性方程组如下：
$$
\left [ \begin{matrix}
x_b - x_a & x_c - x_a \\
y_b - y_a & y_c - y_a
\end{matrix} \right ]
\left [ \begin{matrix}
\beta \\
\gamma
\end{matrix} \right ] =
\left [ \begin{matrix}
x_p - x_a \\
y_p - y_a
\end{matrix} \right ] \tag{2.31}
$$
尽管可以直接使用代数方法来求解方程(2.31)，但是计算一个直接的几何解通常是很有用的。
重心坐标有一个几何属性，即它是该点到三角形边所在直线的有向比例距离（scaled signed distance），如图2.37所示的$\beta$。
![图2.37](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202205021542760.png)
> **图2.37**：重心坐标$\beta$是平面上一点到经过$\mathbf{a, c}$的直线的有向比例距离。

回顾一下，我们在章节2.5.2中提到，对于直线$f(x, y) = 0$，方程$f(x, y)$的值代表了点$(x, y)$到该直线的有向比例距离；另外，如果$f(x, y) = 0$是一条特定直线的方程，那么对于任意不为0的$k$，$kf(x, y) = 0$也是该直线的方程。$k$值缩放了点到直线的距离，同时控制了直线的正侧和负侧。我们希望选择这样一个$k$，使得$kf(x, y) = \beta$。由于方程中的$k$是唯一一个未知数，我们可以对其进行限制，即在点$\mathbf{b}$我们知道$\beta = 1$。因此如果直线$f_{ac}(x, y) = 0$经过点$\mathbf{a, c}$，然后我们可以对点$(x, y)$计算$\beta$：
$$
\beta = \frac{f_{ac}(x, y)}{f_{ac}(x_b, y_b)} \tag{2.32}
$$
然后我们可以通过同样的方式来计算$\gamma, \alpha$。为了提高效率，一般只会计算两个重心坐标，第三个直接使用方程(2.30)计算得出。
为了找到通过点$\mathbf{p}_0, \mathbf{p}_1$的直线的“理想”形式，首先我们可以使用章节2.5.2中的方法，通过顶点找到一些符合要求的隐式直线。方程(2.17)告诉我们：
$$
f_{ab}(x, y) \equiv (y_a - y_b)x + (x_b - x_a)y + x_ay_b - x_by_a = 0
$$
请注意，$f_{ab}(x_c, y_c)$的值可能不为1，因此上述方程可能并不是我们理想中的形式。根据方程(2.32)，将等式两边同除以$f_{ab}(x_c, y_c)$，可得：
$$
\gamma = \frac{(y_a - y_b)x + (x_b - x_a)y + x_ay_b - x_by_a}{(y_a - y_b)x_c + (x_b - x_a)y_c + x_ay_b - x_by_a}
$$
上述方程中出现了除法，它可能会导致除以0的情况发生，但是这种情况不会发生在三角形的情况中，因为三角形的面积不会接近于0。利用同样的方法可以计算出$\alpha, \beta$，但是只需要计算出一个即可：
$$
\beta = \frac{(y_a - y_b)x + (x_b - x_a)y + x_ay_b - x_by_a}{(y_a - y_b)x_c + (x_b - x_a)y_c + x_ay_b - x_by_a} \\[2mm]
\alpha = 1 - \beta - \gamma
$$
![图2.38](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202205021623895.png)
> **图2.38**：重心坐标是子三角形面积和大三角形面积的比值。

计算重心坐标的另一种方法是计算子三角形$A_a, A_b, A_c$的面积（如图2.38）。，其中$A_a$是点$a$相对的小三角形，以此类推。重心坐标遵循以下规则：
$$
\alpha = A_a/A \\
\beta = A_b/A \\
\gamma = A_c/A
\tag{2.33}
$$
其中$A$是大三角形的面积，且$A = A_a + A_b + A_c$，因此在计算三个小三角形的面积之和，通过两个加直接计算出大三角形的面积，而不是利用公式重新计算一遍。
![图2.39](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202205021637198.png)
> **图2.39**：图中所示的两个三角形有相同的底边长，因此它们的面积和其高度成正比。拥有相同底边的三角形，另外一个顶点在$\beta = 0.5$的直线上，它们拥有相同的面积，即三角形面积和$\beta$成正比。

如果三角形的面积可以带入符号计算的话，那么根据这个规则计算出的系数对三角形外的点同样有效。原因如图2.39所示。请注意，这里提到的面积都是带有符号的，在计算三角形$A, A_a, A_b, A_c$面积的时候需要带入相同的符号进行计算。

### 2.7.2 三维三角形

一个很棒事情是，重心坐标可以几乎无缝切换到在三维中的情况。假设点$\mathbf{a, b, c}$都是三维空间中的点，我们仍然可以使用以下表达式：
$$
\mathbf{p} = (1 - \beta - \gamma) \mathbf{a} + \beta \mathbf{b} + \gamma \mathbf{c}
$$
现在当我们改变$\beta, \gamma$的时候，函数$\mathbf{p}$将扫描出一个平面。
![图2.40](https://morakito-blog.oss-cn-beijing.aliyuncs.com/Fundamentals-of-Computer-Graphics-4th/Chapter-2/202205021652959.png)
> **图2.40**：三角形的法向量垂直于三角形所在平面的所有向量，即垂直于三角形的三条边。

三角形的法向量可以通过三角形所在平面上任意两个向量的叉乘获得（图2.40），使用三角形三边中的任意两个来作为向量计算法线是最方便的：
$$\mathbf{n = (b - a) \times (c - a)} \tag{2.34}$$
这个法向量并不一定是单位向量，它遵循叉乘的右手定则。
三角形的面积可以通过叉乘向量的长度获得：
$$area = \frac{1}{2} \Vert \mathbf{n = (b - a) \times (c -a)} \Vert \tag{2.35}$$
请注意这并不是一个带有符号的面积，因此它并不能直接用来计算重心坐标。但是我们可以观察到：一个具有“顺时针”顶点顺序的三角形的法向量，和同一平面上具有“逆时针”顶点顺序的三角形的法向量方向相反。回顾向量点乘的公式：
$$\mathbf{a} \cdot \mathbf{b} = \Vert \mathbf{a} \Vert \Vert \mathbf{b} \Vert \cos{\phi} $$
其中的$\phi$是两个向量之间的夹角。如果向量$\mathbf{a, b}$平行，那么$\cos \phi \pm 1$，这可以用来判断向量是否同向或者反向。因此，联立方程(2.33)，(2.34)和(2.35)，我们可以解得：
$$
\alpha = \frac{\mathbf{n} \ cdot \mathbf{n}_a}{\Vert \mathbf{n} \Vert^2} \\
\beta = \frac{\mathbf{n} \ cdot \mathbf{n}_b}{\Vert \mathbf{n} \Vert^2} \\
\gamma = \frac{\mathbf{n} \ cdot \mathbf{n}_c}{\Vert \mathbf{n} \Vert^2}
$$
其中$\mathbf{n}$是将$\mathbf{a, b, c}$带入方程(2.34)计算出的结果；$\mathbf{n}_a$是将$\mathbf{b, c, p}$带入方程(2.34)计算出的结果，以此类推。它们的长度分别是各个三角形面积的2倍；且$\mathbf{n}_a, \mathbf{n}_b, \mathbf{n}_c$和$\mathbf{n}$要么是同向，要么是反向的。前者决定了大小，后者决定了符号。即：
$$
\mathbf{n}_a = \mathbf{(c - b) \times (p - b)}, \\
\mathbf{n}_b = \mathbf{(a - c) \times (p - c)}, \\
\mathbf{n}_c = \mathbf{(b - a) \times (p - a)}. \tag{2.36}
$$

## 常见问答

**1，为什么没有向量除法？**

结果表明，对于向量除法没有什么“好的”类比。但是，仔细研究这个问题可以引发有关四元数的内容（详见章节注释中引用的Hoffman的书）。

**2，对于大于三边的多边形，有没有像重心坐标一样的整洁方法？**

很不幸的是没有。即便是最简单的凸四边形，情况也要复杂的多。这也是为什么三角形是图形学中常见基本图元的原因之一。

**3，三维直线有没有隐式形式？**

没有。但是两个三维平面相交形成了一个三维直线，因此一个三维直线可以被描述成两个隐式三维平面方程的联立。

## 备注

向量分析的历史是非常有趣的。它主要是由Grassman在18世纪中期发明，但是在之后被遗忘然后再次发明（Crowe, 1994）。Grassman现在在图形领域有一批追随者，他们基于Grassman的思想来研究*几何代数*（(Doran & Lasenby, 2003）。读者们可以对为什么特定的标量和向量相乘是在某种意义上是正确的，为什么我们没有一种常用的向量除法，你可以从*About Vectors*(Hoffmann, 1975)一书中获得启发。另一个重要的几何工具是*四元数*，它由Hamilton在18世纪中期发明。四元数在很多情况下都非常有用，特别是在涉及方向问题的时候(Hanson, 2005)。
